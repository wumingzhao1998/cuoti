# 飞书多维表格设置指南

## 表格结构

根据PRD文档，需要创建两个表格：

### 1. 主表：错题本

用于存储错题记录。

**字段列表：**

| 字段名 | 字段类型 | 选项/说明 |
|--------|---------|----------|
| 创建时间 | 日期时间 | 自动记录 |
| 学科 | 单选 | 数学/语文/英语 |
| 错题原题 | 附件 | 原始错题照片 |
| 去手写 | 附件 | 去除手写后的题目图片 |
| 知识点 | 多选 | 可自定义标签 |
| 不会/做错 | 单选 | 不会/做错 |
| 不会/做错的原因 | 文本 | 不会/做错的原因 |
| 引导问题 | 文本 | AI生成的引导问题 |
| 思考过程 | 文本 | 学生思考过程记录 |
| 解题思路 | 文本 | 最终形成的解题思路 |
| 解题清单 | 文本 | 标准化的解题步骤 |
| 记忆口诀 | 文本 | 记忆口诀 |
| 是否母题 | 单选 | 是/否 |
| 掌握程度 | 单选 | 未掌握/掌握中/已掌握 |
| 最后复习时间 | 日期时间 | 最后复习时间 |
| 复习次数 | 数字 | 复习次数统计 |

### 2. 关联表：反馈题

用于存储基于母题生成的反馈题。

**字段列表：**

| 字段名 | 字段类型 | 选项/说明 |
|--------|---------|----------|
| 创建时间 | 日期时间 | 自动记录 |
| 母题ID | 关联 | 关联到错题本表 |
| 题目内容 | 文本 | 反馈题题目 |
| 难度 | 单选 | 基础/进阶/挑战 |
| 答案 | 文本 | 标准答案 |
| 学生答案 | 文本 | 学生作答答案 |
| 是否正确 | 单选 | 正确/错误 |

## 获取表格Token

### 步骤1：打开多维表格

在飞书中打开你的多维表格，URL格式类似：
```
https://xxx.feishu.cn/base/xxxxxxxxxxxxx?table=tblXXXXXXXX
```

### 步骤2：获取base_id

从URL中获取 `base/` 后面的部分，这就是 `FEISHU_TABLE_ID`。

### 步骤3：获取表格Token

1. **错题本表格**：
   - 切换到"错题本"表
   - 从URL中获取 `table=` 后面的部分（如 `tblXXXXXXXX`）
   - 这就是 `FEISHU_TABLE_TOKEN`

2. **反馈题表格**：
   - 切换到"反馈题"表
   - 从URL中获取 `table=` 后面的部分（如 `tblYYYYYYYY`）
   - 这就是 `FEISHU_FEEDBACK_TABLE_TOKEN`

### 步骤4：配置到config.py

```python
# 飞书多维表格配置
FEISHU_APP_ID = "your_app_id"
FEISHU_APP_SECRET = "your_app_secret"
FEISHU_TABLE_ID = "your_base_id"  # 两个表共享同一个base_id

# 主表：错题本
FEISHU_TABLE_TOKEN = "tblXXXXXXXX"  # 错题本表格的token

# 关联表：反馈题
FEISHU_FEEDBACK_TABLE_TOKEN = "tblYYYYYYYY"  # 反馈题表格的token
```

## 设置关联字段

### 在反馈题表中设置"母题ID"关联字段

1. 在反馈题表中，创建"母题ID"字段
2. 字段类型选择"关联"
3. 关联到"错题本"表
4. 选择关联方式（通常选择"多对一"或"多对多"）

## 验证配置

运行测试脚本验证配置：

```bash
python test_basic.py
```

如果配置正确，飞书连接测试应该通过。

## 常见问题

### Q: 两个表必须在同一个多维表格中吗？

A: 是的，两个表必须在同一个多维表格（base）中，因为它们共享同一个 `FEISHU_TABLE_ID`。

### Q: 如果只有一个表怎么办？

A: 如果暂时只有错题本表，可以不配置 `FEISHU_FEEDBACK_TABLE_TOKEN`。但在使用反馈题功能时会提示需要配置。

### Q: 如何创建第二个表？

A: 在飞书多维表格中，点击"+"按钮添加新表，命名为"反馈题"，然后按照上面的字段列表创建字段。

